{"version":3,"sources":["components/VideoItem/style.module.scss","pages/HomePage/style.module.scss","pages/PlayPage/style.module.scss","components/VideoItem/index.js","pages/HomePage/index.js","pages/PlayPage/index.js","pages/FavoritePage/index.js","App.js","reportWebVitals.js","index.js"],"names":["module","exports","VideoItem","props","className","style","to","id","src","snippet","thumbnails","default","url","alt","title","description","contentDetails","duration","onClick","bind","this","buttonText","KEY","process","MAX","lastPage","Math","ceil","SEARCH_URL","POPULAR_URL","_videoList","fetchVideo","URL","cb","nextPageToken","fetch","then","res","json","items","length","HomePage","inputDOM","useRef","location","useLocation","useState","videoList","setVideoList","urlParams","URLSearchParams","search","page","Number","get","addFavorite","video","favoriteVideo","updateFavoriteVideo","updateVideoList","min","useEffect","onSubmit","e","preventDefault","searchText","current","value","trim","data","idList","map","videoId","slice","join","type","ref","required","disabled","pagination","Array","keys","i","loading","VIDEO_URL","PlayPage","player","videoID","videoInfo","setVideoInfo","playing","setPlaying","enableAD","setEnableAD","handleSeek","sec","currentTime","getCurrentTime","seekTo","useLayoutEffect","Player","controls","playsinline","onPause","AD","FavoritePage","removeFavorite","Object","App","JSON","parse","localStorage","getItem","setFavoriteVideo","setItem","stringify","exact","path","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.25340d5c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"VideoItem\":\"style_VideoItem__22_xz\",\"duration\":\"style_duration__2wVkD\",\"title\":\"style_title__1oZt5\",\"description\":\"style_description__3aa3G\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"HomePage\":\"style_HomePage__39HyE\",\"loading\":\"style_loading__2xXeE\",\"pagination\":\"style_pagination__1icEQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"PlayPage\":\"style_PlayPage__3Nf3F\",\"Player\":\"style_Player__1FIqP\",\"AD\":\"style_AD__15s8F\"};","/** 套件 */\nimport { Link } from \"react-router-dom\";\n\n/** 樣式 */\nimport style from './style.module.scss';\n\nexport function VideoItem(props) {\n  return (\n    <div className={style.VideoItem}>\n      <Link to={`/play?id=${props.id}`}>\n        <img src={props.snippet.thumbnails.default.url} alt={props.snippet.title} />\n        <div className={style.title}>{props.snippet.title}</div>\n        <div className={style.description}>{props.snippet.description}</div>\n        {props.contentDetails &&\n          <div className={style.duration}>{props.contentDetails.duration}</div>\n        }\n      </Link>\n      <button onClick={props.onClick.bind(this, props)}>{props.buttonText}</button>\n    </div>\n  )\n}\n","/** 套件 */\nimport { useEffect, useState, useRef } from 'react';\nimport { Link, useLocation } from \"react-router-dom\";\n\n/** 自訂元件 */\nimport { VideoItem } from \"components\";\n\n/** 樣式 */\nimport style from './style.module.scss';\n\n/** 環境變數 */\nconst { REACT_APP_KEY: KEY } = process.env;\n\nconst MAX = 100;\nconst PAGESIZE = 12;\nlet lastPage = Math.ceil(MAX / PAGESIZE);\nconst SEARCH_URL = `https://www.googleapis.com/youtube/v3/search?key=${KEY}&maxResults=50&part=snippet&q=`;\nconst POPULAR_URL = `https://www.googleapis.com/youtube/v3/videos?key=${KEY}&maxResults=50&part=snippet,contentDetails,statistics`\n\nlet _videoList = [];\n\n/** 因為 youtube 有限制搜尋1次最多回傳50筆，所以需要重複搜尋，直到我們要的數量再停 */\nconst fetchVideo = (URL, cb, nextPageToken = '') => {\n  fetch(`${URL}${nextPageToken}`)\n    .then(res => res.json())\n    .then(({ items, nextPageToken }) => {\n      _videoList = [..._videoList, ...items];\n      if(_videoList.length < MAX && nextPageToken)\n        fetchVideo(URL, cb, `&pageToken=${nextPageToken}`);\n      else {\n        cb(_videoList);\n      }\n    });\n}\n\nexport const HomePage = props => {\n\n  const inputDOM = useRef();\n  const location = useLocation();\n  const [ videoList, setVideoList ] = useState([]);\n\n  const urlParams = new URLSearchParams(location.search);\n  const page = Number(urlParams.get('page') ?? 1);\n\n  const addFavorite = video => {\n    const { favoriteVideo } = props;\n    favoriteVideo[video.id] = video;\n    props.updateFavoriteVideo(favoriteVideo);\n  }\n\n  const updateVideoList = videoList => {\n    lastPage = Math.ceil(Math.min(MAX, _videoList.length) / PAGESIZE);\n    setVideoList(videoList);\n  }\n\n  /** 加分題：搜尋, 但輸入空白不搜尋 */\n  const handleSerach = e => {\n    e.preventDefault();\n    const searchText = inputDOM.current.value.trim();\n    if(!searchText) return;\n\n    setVideoList([]);\n\n    _videoList = [];\n    fetchVideo(`${SEARCH_URL}${searchText}`, data => {\n      /** 因為使用 search 與 video api 拿到的資料結構不同，所以需要在資料搜集完畢時調整一次 id 的規格 */\n      const idList = data.map(({ id: { videoId}}) => videoId ).slice(0, 50).join(',');\n      _videoList = [];\n      fetchVideo(`${POPULAR_URL}&id=${idList}`, updateVideoList);\n    });\n  }\n\n  /** 一進到首頁就取得熱門影片 */\n  useEffect(() => {\n    _videoList = [];\n    fetchVideo(`${POPULAR_URL}&chart=mostPopular`, updateVideoList);\n  }, []);\n\n  return (\n    <div className={style.HomePage}>\n      <ul>\n        <li><Link to=\"/\">首頁</Link></li>\n        <li><Link to=\"/favorite\">收藏頁</Link></li>\n      </ul>\n      <h1>首頁</h1>\n      <form onSubmit={handleSerach}>\n        <input type=\"text\" ref={inputDOM} required disabled={videoList.length === 0} />\n      </form>\n      <ul className={style.pagination}>\n        <li>{page > 1 && <Link to={`/?page=${page - 1}`}>上一頁</Link>}</li>\n        {[...Array(lastPage).keys()].map(i =>\n          <li key={i}><Link to={`/?page=${i + 1}`}>{i + 1}</Link></li>\n        )}\n        <li>{page < (MAX / PAGESIZE) && <Link to={`/?page=${page + 1}`}>下一頁</Link>}</li>\n      </ul>\n      <hr/>\n      {!videoList.length &&\n        <div className={style.loading}>\n          Loading\n        </div>\n      }\n      {videoList.slice((page - 1) * PAGESIZE, page * PAGESIZE).map(video =>\n        <VideoItem\n          key={video.id}\n          {...video}\n          onClick={addFavorite}\n          buttonText=\"收藏\"\n        />\n      )}\n    </div>\n  )\n}\n","/** 套件 */\nimport { useState, useLayoutEffect, useRef } from \"react\";\nimport { Link, useLocation } from \"react-router-dom\";\nimport ReactPlayer from 'react-player'\n\n/** 樣式 */\nimport style from \"./style.module.scss\";\n\n/** 環境變數 */\nconst { REACT_APP_KEY: KEY } = process.env;\n\nconst VIDEO_URL = `https://www.googleapis.com/youtube/v3/videos?key=${KEY}&part=snippet,contentDetails,statistics&id=`;\n\nexport const PlayPage = () => {\n\n  const player = useRef();\n  const location = useLocation();\n  const videoID = new URLSearchParams(location.search).get('id');\n  \n  const [ videoInfo, setVideoInfo ] = useState({});\n  const [ playing, setPlaying ] = useState(true);\n  const [ enableAD, setEnableAD ] = useState(false);\n\n  /** 回復播放並關閉廣告 */\n  const handleResume = () => {\n    setPlaying(true);\n    setEnableAD(false);\n  }\n\n  /** 暫停播放並打開廣告 */\n  const handlePause = () => {\n    setPlaying(false);\n    setEnableAD(true);\n  }\n\n  /** 影片 前進 / 後退 */\n  const handleSeek = sec => {\n    const currentTime = player.current.getCurrentTime();\n    player.current.seekTo(currentTime + sec, 'seconds');\n  }\n\n  /** 只抓必要的資訊進來就好 */\n  useLayoutEffect(() => {\n    fetch(`${VIDEO_URL}${videoID}`)\n      .then(res => res.json())\n      .then(({ items }) => {\n        setVideoInfo(items[0].snippet);\n      });\n  }, [videoID])\n\n  return (\n    <div className={style.PlayPage}>\n      <ul>\n        <li><Link to=\"/\">首頁</Link></li>\n        <li><Link to=\"/favorite\">收藏頁</Link></li>\n      </ul>\n      <h1>{videoInfo.title}</h1>\n      <div className={style.Player}>\n        <ReactPlayer\n          controls\n          playsinline\n          ref={player}\n          playing={playing}\n          onPause={handlePause}\n          url='https://bitdash-a.akamaihd.net/content/MI201109210084_1/m3u8s/f08e80da-bf1d-4e3d-8899-f0f6155f6efa.m3u8'\n        />\n        {enableAD &&\n          <div className={style.AD}>\n            <h3>AD</h3>\n            <button onClick={handleResume}>close AD</button>\n          </div>\n        }\n      </div>\n      <button onClick={handleSeek.bind(this, 15)}>forward 15sec</button>\n      <button onClick={handleSeek.bind(this, -15)}>back 15sec</button>\n      <div>{videoInfo.description}</div>\n    </div>\n  )\n}\n\n/** refs: https://github.com/cookpete/react-player/issues/724#issuecomment-541413917 */","/** 套件 */\nimport { Link } from \"react-router-dom\";\n\n/** 自訂元件 */\nimport { VideoItem } from \"components\";\n\nexport const FavoritePage = props => {\n\n  const { favoriteVideo, updateFavoriteVideo } = props;\n\n  const removeFavorite = video => {\n    delete favoriteVideo[video.id];\n    updateFavoriteVideo(favoriteVideo);\n  }\n\n  return (\n    <div>\n      <ul>\n        <li><Link to=\"/\">首頁</Link></li>\n        <li><Link to=\"/favorite\">收藏頁</Link></li>\n      </ul>\n      <h1>收藏頁</h1>\n      {Object.keys(favoriteVideo).map(videoID =>\n        <VideoItem\n          key={videoID}\n          {...favoriteVideo[videoID]}\n          onClick={removeFavorite}\n          buttonText=\"取消收藏\"\n        />\n      )}\n    </div>\n  )\n}\n","import { useState } from \"react\";\n\nimport {\n  Route,\n  Switch,\n  HashRouter as Router,\n} from \"react-router-dom\";\nimport style from './App.module.scss';\n\nimport {\n  HomePage,\n  PlayPage,\n  FavoritePage,\n} from \"pages\";\n\nfunction App() {\n\n  const [favoriteVideo, setFavoriteVideo] = useState(JSON.parse(localStorage.getItem('favoriteVideo')) ?? {});\n\n  const updateFavoriteVideo = favoriteVideo => {\n    localStorage.setItem('favoriteVideo', JSON.stringify(favoriteVideo));\n\n    /** 這邊使用 ... 來設定新的記憶體位置，不然不會觸發 render */\n    setFavoriteVideo({...favoriteVideo});\n  }\n\n  return (\n    <Router>\n      <div className={style.App}>\n        <Switch>\n          <Route exact path=\"/play\"><PlayPage /></Route>\n          <Route exact path=\"/favorite\">\n            <FavoritePage {...{ favoriteVideo, updateFavoriteVideo }} />\n          </Route>\n          <Route exact path=\"/\">\n            <HomePage {...{ favoriteVideo, updateFavoriteVideo }} />\n          </Route>\n        </Switch>\n      </div>\n    </Router>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n    <App />,\n  // <React.StrictMode>\n  // </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}